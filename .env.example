#------------------------------------------------------------------------------
# Laravel App Context - Environment Variables
#------------------------------------------------------------------------------
# Copy this file to .env and adjust values for your environment

#------------------------------------------------------------------------------
# Core Configuration
#------------------------------------------------------------------------------

# Base domain for subdomain extraction (e.g., myapp.com)
APP_CONTEXT_DOMAIN=localhost

# Detection strategy: auto, path, subdomain, strict
# - auto: Smart detection based on host (recommended for most cases)
# - path: Path-based only (/api/*, /mobile/*) - good for development
# - subdomain: Subdomain-based only (admin.myapp.com) - production
# - strict: Both must match same channel - maximum security
APP_CONTEXT_DETECTION=auto

# Reject requests that don't match any channel (recommended: true for production)
APP_CONTEXT_DENY_BY_DEFAULT=true

# Development contexts that prefer path detection (comma-separated)
# When APP_DEV matches one of these, path detection is preferred on root domain
APP_CONTEXT_DEV=local

# Current dev environment identifier (used with APP_CONTEXT_DEV)
APP_DEV=local

#------------------------------------------------------------------------------
# JWT Configuration
#------------------------------------------------------------------------------

# Algorithm: HS256 (symmetric) or RS256 (asymmetric, recommended for production)
JWT_ALGO=HS256

# Secret for HS256 (min 32 characters)
JWT_SECRET=your-super-secret-key-min-32-characters

# Key paths for RS256 (only needed if JWT_ALGO=RS256)
JWT_PUBLIC_KEY_PATH=storage/keys/jwt-public.pem
JWT_PRIVATE_KEY_PATH=storage/keys/jwt-private.pem

# Passphrase for private key (if encrypted)
# JWT_PASSPHRASE=

# Expected issuer (usually your app URL)
JWT_ISSUER=http://localhost

# Token TTL in minutes (60 = 1 hour)
JWT_TTL=60

# Refresh token TTL in minutes (20160 = 14 days)
JWT_REFRESH_TTL=20160

# Enable token blacklist (requires Redis for production)
JWT_BLACKLIST_ENABLED=true

# Verify issuer claim in tokens
JWT_VERIFY_ISS=true

# Verify audience claim in tokens
JWT_VERIFY_AUD=true

#------------------------------------------------------------------------------
# API Key Configuration (B2B/Partner Authentication)
#------------------------------------------------------------------------------

# Hash algorithm: argon2id (recommended) or bcrypt
API_KEY_HASH_ALGO=argon2id

# Header names for API key authentication
API_KEY_CLIENT_ID_HEADER=X-Client-Id
API_KEY_HEADER=X-Api-Key

# Key rotation settings
API_KEY_ROTATION_DAYS=90
API_KEY_WARNING_DAYS=15
API_KEY_MAX_PER_CLIENT=5

#------------------------------------------------------------------------------
# Rate Limiting
#------------------------------------------------------------------------------

# Format: {requests}/{period} where period is s/m/h/d

# Mobile channel
RATE_LIMIT_MOBILE_GLOBAL=60/m

# Admin channel
RATE_LIMIT_ADMIN_GLOBAL=120/m

# Site channel (public website)
RATE_LIMIT_SITE_ANON=30/m
RATE_LIMIT_SITE_AUTH=60/m

# Partner channel (B2B)
RATE_LIMIT_PARTNER_GLOBAL=600/m

#------------------------------------------------------------------------------
# Security Features
#------------------------------------------------------------------------------

# Prevent tenant hopping attacks (recommended: true)
APP_CONTEXT_TENANT_BINDING=true

# Require IP allowlist for API Key authentication
APP_CONTEXT_IP_ALLOWLIST=false

# Enable anomaly detection (requires additional storage)
APP_CONTEXT_ANOMALY_DETECTION=false

# Require MFA for admin channel
ADMIN_MFA_REQUIRED=false

#------------------------------------------------------------------------------
# Audit & Logging
#------------------------------------------------------------------------------

# Enable audit logging
APP_CONTEXT_AUDIT=true

# Log channel to use (stack, single, daily, slack, etc.)
APP_CONTEXT_LOG_CHANNEL=stack

# Include request body in logs (WARNING: may log sensitive data)
APP_CONTEXT_LOG_BODY=false

# Include response body in logs
APP_CONTEXT_LOG_RESPONSE=false

# Log all requests (not just errors)
APP_CONTEXT_LOG_ALL=false

# Log all responses
APP_CONTEXT_LOG_RESPONSES=false

# Log failed authentication attempts (recommended: true)
APP_CONTEXT_LOG_FAILED_AUTH=true

#------------------------------------------------------------------------------
# Additional Notes
#------------------------------------------------------------------------------

# For RS256 keys generation:
# openssl genrsa -out storage/keys/jwt-private.pem 4096
# openssl rsa -in storage/keys/jwt-private.pem -pubout -out storage/keys/jwt-public.pem
# chmod 600 storage/keys/jwt-private.pem
# chmod 644 storage/keys/jwt-public.pem

# For production, use Redis for:
# - JWT blacklist (config/jwt.php -> 'blacklist_cache' => 'redis')
# - Rate limiting (config/cache.php -> 'default' => 'redis')
# - Session (config/session.php -> 'driver' => 'redis')
